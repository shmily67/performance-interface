import multiprocessing
from UserTas1_pb2 import LoginReq, LoginRsp  # , LogoutReq, LogoutRsp
from client_driver import Client

server_ip, server_port = 127.0.0.1, 12345


def client_proc_func(account_type, login_code, password):
    clt = Client(server_ip, server_port)
    try:
        login_req = UserTas1_pb2.LoginReq(
    	    AccountType = account_type,     #required int32     账户类型 <- table userinfo
        	LoginCode = login_code, #optional string    登录号码
        	LoginPWD = password,       #optional string    登录密码, 应该是密文，暂时不检查
            )    
        clt.send(131293, login_req)
        rsp = clt.expect(131294, 5.0)
        return 'Pass'
    except Exception as e:
        return e
    finally:
        clt.close()        


login_data_set = (
    (111, '100100', '123456'),
    (111, '100101', '123456'),
    (111, '100102', '123456'),
)    
    
if __name__ == '__main__':
    p = multiprocessing.Pool(len(login_data_set))
    print(p.map(client_proc_func, login_data_set))
